var entry = {
	"took": 2,
	"timed_out": false,
	"_shards": {
		"total": 6,
		"successful": 6,
		"skipped": 0,
		"failed": 0
	},
	"hits": {
		"total": 1,
		"max_score": 12.044575,
		"hits": [
			{
				"_index": "cvr-v-20181028",
				"_type": "_doc",
				"_id": "4000824158",
				"_score": 12.044575,
				"_source": {
					"Vrvirksomhed": {
						"cvrNummer": 11617034,
						"regNummer": [],
						"brancheAnsvarskode": null,
						"reklamebeskyttet": false,
						"navne": [
							{
								"navn": "F.L.SMIDTH & CO. A/SS LEGAT TIL KØBENHAVNS TEKNIKUM",
								"periode": {
									"gyldigFra": "1901-01-01",
									"gyldigTil": "2017-11-05"
								},
								"sidstOpdateret": "2017-11-09T15:06:12.000+01:00"
							},
							{
								"navn": "F.L.Smidth fonden for diplomingeniørstuderende ved DTU",
								"periode": {
									"gyldigFra": "2017-11-06",
									"gyldigTil": null
								},
								"sidstOpdateret": "2017-11-09T15:06:12.000+01:00"
							}
						],
						"binavne": [],
						"postadresse": [],
						"beliggenhedsadresse": [
							{
								"landekode": "DK",
								"fritekst": null,
								"vejkode": 196,
								"kommune": {
									"kommuneKode": 151,
									"kommuneNavn": "BALLERUP",
									"periode": {
										"gyldigFra": "2007-01-01",
										"gyldigTil": null
									},
									"sidstOpdateret": "2006-11-13T00:00:00.000+01:00"
								},
								"husnummerFra": 15,
								"adresseId": null,
								"sidstValideret": null,
								"husnummerTil": null,
								"bogstavFra": null,
								"bogstavTil": null,
								"etage": null,
								"sidedoer": null,
								"conavn": "ING.HØJSKOLEN KBH. TEKNIKUM",
								"postboks": null,
								"vejnavn": "Lautrupvang",
								"bynavn": null,
								"postnummer": 2750,
								"postdistrikt": "Ballerup",
								"periode": {
									"gyldigFra": "1901-01-01",
									"gyldigTil": "2017-11-05"
								},
								"sidstOpdateret": "2017-11-09T15:06:12.000+01:00"
							},
							{
								"landekode": "DK",
								"fritekst": null,
								"vejkode": 24,
								"kommune": {
									"kommuneKode": 173,
									"kommuneNavn": "LYNGBY-TAARBÆK",
									"periode": {
										"gyldigFra": "2007-01-01",
										"gyldigTil": null
									},
									"sidstOpdateret": "2006-11-13T00:00:00.000+01:00"
								},
								"husnummerFra": 101,
								"adresseId": "cb1667b2-0103-4696-82c3-11f4cd34ab3d",
								"sidstValideret": "2017-11-09T15:27:35.088+01:00",
								"husnummerTil": null,
								"bogstavFra": "A",
								"bogstavTil": null,
								"etage": null,
								"sidedoer": null,
								"conavn": "Danmarks Tekniske Universitet",
								"postboks": null,
								"vejnavn": "Anker Engelunds Vej",
								"bynavn": null,
								"postnummer": 2800,
								"postdistrikt": "Kgs. Lyngby",
								"periode": {
									"gyldigFra": "2017-11-06",
									"gyldigTil": null
								},
								"sidstOpdateret": "2017-11-09T15:06:12.000+01:00"
							}
						],
						"telefonNummer": [
							{
								"kontaktoplysning": "44978088",
								"hemmelig": false,
								"periode": {
									"gyldigFra": "2000-01-23",
									"gyldigTil": "2002-11-11"
								},
								"sidstOpdateret": "2000-04-01T14:12:07.000+02:00"
							}
						],
						"telefaxNummer": [
							{
								"kontaktoplysning": "44805044",
								"hemmelig": false,
								"periode": {
									"gyldigFra": "2001-05-21",
									"gyldigTil": "2002-11-11"
								},
								"sidstOpdateret": "2001-05-25T19:30:32.000+02:00"
							}
						],
						"sekundaertTelefonNummer": [],
						"sekundaertTelefaxNummer": [],
						"elektroniskPost": [
							{
								"kontaktoplysning": "studam@cph.ih.dk",
								"hemmelig": false,
								"periode": {
									"gyldigFra": "2000-11-02",
									"gyldigTil": "2002-11-11"
								},
								"sidstOpdateret": "2000-11-14T19:30:30.000+01:00"
							}
						],
						"hjemmeside": [],
						"obligatoriskEmail": [],
						"livsforloeb": [
							{
								"periode": {
									"gyldigFra": "1901-01-01",
									"gyldigTil": null
								},
								"sidstOpdateret": "1999-10-16T19:49:48.000+02:00"
							}
						],
						"hovedbranche": [
							{
								"branchekode": "980000",
								"branchetekst": "Uoplyst",
								"periode": {
									"gyldigFra": "1901-01-01",
									"gyldigTil": "2002-12-31"
								},
								"sidstOpdateret": "2013-11-22T22:19:29.000+01:00"
							},
							{
								"branchekode": "853260",
								"branchetekst": "Legater og fonde med velgørende formål",
								"periode": {
									"gyldigFra": "2003-01-01",
									"gyldigTil": "2007-12-31"
								},
								"sidstOpdateret": "2004-09-14T14:42:42.000+02:00"
							},
							{
								"branchekode": "889910",
								"branchetekst": "Foreninger, legater og fonde med sygdomsbekæmpende, sociale og velgørende formål",
								"periode": {
									"gyldigFra": "2008-01-01",
									"gyldigTil": null
								},
								"sidstOpdateret": "2007-12-21T11:55:53.000+01:00"
							}
						],
						"bibranche1": [],
						"bibranche2": [],
						"bibranche3": [],
						"status": [],
						"virksomhedsstatus": [],
						"virksomhedsform": [
							{
								"virksomhedsformkode": 90,
								"kortBeskrivelse": "FON",
								"langBeskrivelse": "Fonde og andre selvejende institutioner",
								"ansvarligDataleverandoer": "T&S",
								"periode": {
									"gyldigFra": "1901-01-01",
									"gyldigTil": null
								},
								"sidstOpdateret": "2013-11-22T21:57:52.000+01:00"
							}
						],
						"aarsbeskaeftigelse": [],
						"kvartalsbeskaeftigelse": [],
						"maanedsbeskaeftigelse": [],
						"attributter": [],
						"penheder": [
							{
								"pNummer": 1005408410,
								"periode": {
									"gyldigFra": "1901-01-01",
									"gyldigTil": null
								},
								"sidstOpdateret": "1999-10-17T00:00:00.000+02:00"
							}
						],
						"deltagerRelation": [
							{
								"deltager": {
									"enhedsNummer": 4000345068,
									"enhedstype": "PERSON",
									"forretningsnoegle": null,
									"organisationstype": null,
									"sidstIndlaest": "2019-09-12T17:06:41.470+02:00",
									"sidstOpdateret": "2005-05-18T14:46:52.000+02:00",
									"navne": [
										{
											"navn": "Bente Engholm Madsen",
											"periode": {
												"gyldigFra": null,
												"gyldigTil": null
											},
											"sidstOpdateret": null
										}
									],
									"adresseHemmelig": false,
									"adresseHemmeligUndtagelse": false,
									"adresseOpdateringOphoert": false,
									"beliggenhedsadresse": [
										{
											"landekode": "SE",
											"fritekst": "Götgatan 50\n 216 11 Limhamn",
											"vejkode": null,
											"kommune": {
												"kommuneKode": null,
												"kommuneNavn": null,
												"periode": {
													"gyldigFra": null,
													"gyldigTil": null
												},
												"sidstOpdateret": null
											},
											"husnummerFra": null,
											"adresseId": null,
											"sidstValideret": null,
											"husnummerTil": null,
											"bogstavFra": null,
											"bogstavTil": null,
											"etage": null,
											"sidedoer": null,
											"conavn": null,
											"postboks": null,
											"vejnavn": null,
											"bynavn": null,
											"postnummer": null,
											"postdistrikt": null,
											"periode": {
												"gyldigFra": "2017-11-25",
												"gyldigTil": null
											},
											"sidstOpdateret": null
										}
									]
								},
								"kontorsteder": [],
								"organisationer": [
									{
										"enhedsNummerOrganisation": 4007226333,
										"hovedtype": "REGISTER",
										"organisationsNavn": [
											{
												"navn": "Reelle ejere",
												"periode": {
													"gyldigFra": "1901-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
											}
										],
										"attributter": [
											{
												"sekvensnr": 0,
												"type": "FUNKTION",
												"vaerditype": "string",
												"vaerdier": [
													{
														"vaerdi": "Reelle ejere",
														"periode": {
															"gyldigFra": "1901-01-01",
															"gyldigTil": null
														},
														"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
													}
												]
											}
										],
										"medlemsData": [
											{
												"attributter": [
													{
														"sekvensnr": 0,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som bestyrelsesmedlem",
																"periode": {
																	"gyldigFra": "2017-11-08",
																	"gyldigTil": "2019-05-27"
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													},
													{
														"sekvensnr": 1,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som udpeget daglig ledelse",
																"periode": {
																	"gyldigFra": "2017-11-08",
																	"gyldigTil": "2019-05-27"
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													},
													{
														"sekvensnr": 0,
														"type": "FUNKTION",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Reel ejer",
																"periode": {
																	"gyldigFra": "2017-11-08",
																	"gyldigTil": "2019-05-27"
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													}
												]
											}
										]
									}
								]
							},
							{
								"deltager": {
									"enhedsNummer": 4000389800,
									"enhedstype": "PERSON",
									"forretningsnoegle": null,
									"organisationstype": null,
									"sidstIndlaest": "2019-09-12T17:06:41.470+02:00",
									"sidstOpdateret": "2018-10-23T11:31:29.000+02:00",
									"navne": [
										{
											"navn": "Martin Etchells Vigild",
											"periode": {
												"gyldigFra": null,
												"gyldigTil": null
											},
											"sidstOpdateret": null
										}
									],
									"adresseHemmelig": false,
									"adresseHemmeligUndtagelse": false,
									"adresseOpdateringOphoert": false,
									"beliggenhedsadresse": [
										{
											"landekode": "DK",
											"fritekst": null,
											"vejkode": 238,
											"kommune": {
												"kommuneKode": 147,
												"kommuneNavn": "FREDERIKSBERG",
												"periode": {
													"gyldigFra": "2007-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2006-11-12T23:00:00.000Z"
											},
											"husnummerFra": 19,
											"adresseId": "17a6c5c6-938e-4e79-9f15-3368cc45003f",
											"sidstValideret": "2019-08-07T16:49:24.613Z",
											"husnummerTil": null,
											"bogstavFra": null,
											"bogstavTil": null,
											"etage": "02",
											"sidedoer": "tv",
											"conavn": null,
											"postboks": null,
											"vejnavn": "Finsensvej",
											"bynavn": null,
											"postnummer": 2000,
											"postdistrikt": "Frederiksberg",
											"periode": {
												"gyldigFra": "2018-10-20",
												"gyldigTil": null
											},
											"sidstOpdateret": "2018-10-23T09:31:29.000Z"
										}
									]
								},
								"kontorsteder": [],
								"organisationer": [
									{
										"enhedsNummerOrganisation": 4007226333,
										"hovedtype": "REGISTER",
										"organisationsNavn": [
											{
												"navn": "Reelle ejere",
												"periode": {
													"gyldigFra": "1901-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
											}
										],
										"attributter": [
											{
												"sekvensnr": 0,
												"type": "FUNKTION",
												"vaerditype": "string",
												"vaerdier": [
													{
														"vaerdi": "Reelle ejere",
														"periode": {
															"gyldigFra": "1901-01-01",
															"gyldigTil": null
														},
														"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
													}
												]
											}
										],
										"medlemsData": [
											{
												"attributter": [
													{
														"sekvensnr": 0,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som bestyrelsesmedlem",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": "2019-05-27"
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													},
													{
														"sekvensnr": 1,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som udpeget daglig ledelse",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": "2019-05-27"
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													},
													{
														"sekvensnr": 0,
														"type": "FUNKTION",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Reel ejer",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": "2019-05-27"
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													}
												]
											}
										]
									}
								]
							},
							{
								"deltager": {
									"enhedsNummer": 4004076868,
									"enhedstype": "PERSON",
									"forretningsnoegle": null,
									"organisationstype": null,
									"sidstIndlaest": "2019-09-12T17:06:41.470+02:00",
									"sidstOpdateret": "2015-04-22T20:21:48.000+02:00",
									"navne": [
										{
											"navn": "Lars Dyreborg Christoffersen",
											"periode": {
												"gyldigFra": null,
												"gyldigTil": null
											},
											"sidstOpdateret": null
										}
									],
									"adresseHemmelig": false,
									"adresseHemmeligUndtagelse": false,
									"adresseOpdateringOphoert": false,
									"beliggenhedsadresse": [
										{
											"landekode": "DK",
											"fritekst": null,
											"vejkode": 255,
											"kommune": {
												"kommuneKode": 265,
												"kommuneNavn": "ROSKILDE",
												"periode": {
													"gyldigFra": "2007-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2006-11-12T23:00:00.000Z"
											},
											"husnummerFra": 15,
											"adresseId": "0a3f50ab-367b-32b8-e044-0003ba298018",
											"sidstValideret": "2019-08-21T23:21:09.099Z",
											"husnummerTil": null,
											"bogstavFra": null,
											"bogstavTil": null,
											"etage": null,
											"sidedoer": null,
											"conavn": null,
											"postboks": null,
											"vejnavn": "Hovedgaden",
											"bynavn": "Gundsømagle",
											"postnummer": 4000,
											"postdistrikt": "Roskilde",
											"periode": {
												"gyldigFra": "1991-09-15",
												"gyldigTil": null
											},
											"sidstOpdateret": "2015-04-22T18:21:48.000Z"
										}
									]
								},
								"kontorsteder": [],
								"organisationer": [
									{
										"enhedsNummerOrganisation": 4007226333,
										"hovedtype": "REGISTER",
										"organisationsNavn": [
											{
												"navn": "Reelle ejere",
												"periode": {
													"gyldigFra": "1901-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
											}
										],
										"attributter": [
											{
												"sekvensnr": 0,
												"type": "FUNKTION",
												"vaerditype": "string",
												"vaerdier": [
													{
														"vaerdi": "Reelle ejere",
														"periode": {
															"gyldigFra": "1901-01-01",
															"gyldigTil": null
														},
														"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
													}
												]
											}
										],
										"medlemsData": [
											{
												"attributter": [
													{
														"sekvensnr": 0,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som bestyrelsesmedlem",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
															}
														]
													},
													{
														"sekvensnr": 1,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som udpeget daglig ledelse",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
															}
														]
													},
													{
														"sekvensnr": 0,
														"type": "FUNKTION",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Reel ejer",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
															}
														]
													}
												]
											}
										]
									}
								]
							},
							{
								"deltager": {
									"enhedsNummer": 4007113269,
									"enhedstype": "PERSON",
									"forretningsnoegle": null,
									"organisationstype": null,
									"sidstIndlaest": "2019-09-12T17:06:41.470+02:00",
									"sidstOpdateret": "2019-04-30T02:39:19.000+02:00",
									"navne": [
										{
											"navn": "Jørgen Jensen",
											"periode": {
												"gyldigFra": null,
												"gyldigTil": null
											},
											"sidstOpdateret": null
										}
									],
									"adresseHemmelig": false,
									"adresseHemmeligUndtagelse": false,
									"adresseOpdateringOphoert": false,
									"beliggenhedsadresse": [
										{
											"landekode": "DK",
											"fritekst": null,
											"vejkode": 1260,
											"kommune": {
												"kommuneKode": 101,
												"kommuneNavn": "KØBENHAVN",
												"periode": {
													"gyldigFra": "2007-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2006-11-12T23:00:00.000Z"
											},
											"husnummerFra": 39,
											"adresseId": "0a3f509d-c38e-32b8-e044-0003ba298018",
											"sidstValideret": "2019-08-19T18:56:43.038Z",
											"husnummerTil": null,
											"bogstavFra": "A",
											"bogstavTil": null,
											"etage": "4",
											"sidedoer": null,
											"conavn": "c/o Keller / Wanscher",
											"postboks": null,
											"vejnavn": "Dannebrogsgade",
											"bynavn": null,
											"postnummer": 1660,
											"postdistrikt": "København V",
											"periode": {
												"gyldigFra": "2019-04-27",
												"gyldigTil": null
											},
											"sidstOpdateret": "2019-04-30T00:39:19.000Z"
										}
									]
								},
								"kontorsteder": [],
								"organisationer": [
									{
										"enhedsNummerOrganisation": 4007226333,
										"hovedtype": "REGISTER",
										"organisationsNavn": [
											{
												"navn": "Reelle ejere",
												"periode": {
													"gyldigFra": "1901-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
											}
										],
										"attributter": [
											{
												"sekvensnr": 0,
												"type": "FUNKTION",
												"vaerditype": "string",
												"vaerdier": [
													{
														"vaerdi": "Reelle ejere",
														"periode": {
															"gyldigFra": "1901-01-01",
															"gyldigTil": null
														},
														"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
													}
												]
											}
										],
										"medlemsData": [
											{
												"attributter": [
													{
														"sekvensnr": 0,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som bestyrelsesmedlem",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
															}
														]
													},
													{
														"sekvensnr": 1,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som udpeget daglig ledelse",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
															}
														]
													},
													{
														"sekvensnr": 0,
														"type": "FUNKTION",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Reel ejer",
																"periode": {
																	"gyldigFra": "2017-11-06",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
															}
														]
													}
												]
											}
										]
									}
								]
							},
							{
								"deltager": {
									"enhedsNummer": 4007580588,
									"enhedstype": "PERSON",
									"forretningsnoegle": null,
									"organisationstype": null,
									"sidstIndlaest": "2019-09-12T17:06:41.470+02:00",
									"sidstOpdateret": "2018-04-03T20:06:39.000+02:00",
									"navne": [
										{
											"navn": "Jesper Harris Johansen",
											"periode": {
												"gyldigFra": null,
												"gyldigTil": null
											},
											"sidstOpdateret": null
										}
									],
									"adresseHemmelig": false,
									"adresseHemmeligUndtagelse": false,
									"adresseOpdateringOphoert": false,
									"beliggenhedsadresse": [
										{
											"landekode": "DK",
											"fritekst": null,
											"vejkode": 8240,
											"kommune": {
												"kommuneKode": 101,
												"kommuneNavn": "KØBENHAVN",
												"periode": {
													"gyldigFra": "2007-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2006-11-12T23:00:00.000Z"
											},
											"husnummerFra": 76,
											"adresseId": "0a3f50a1-9e44-32b8-e044-0003ba298018",
											"sidstValideret": "2019-08-07T16:47:53.704Z",
											"husnummerTil": null,
											"bogstavFra": null,
											"bogstavTil": null,
											"etage": "st",
											"sidedoer": "th",
											"conavn": null,
											"postboks": null,
											"vejnavn": "Vester Søgade",
											"bynavn": null,
											"postnummer": 1601,
											"postdistrikt": "København V",
											"periode": {
												"gyldigFra": "2016-08-01",
												"gyldigTil": null
											},
											"sidstOpdateret": "2018-04-03T18:06:39.000Z"
										}
									]
								},
								"kontorsteder": [],
								"organisationer": [
									{
										"enhedsNummerOrganisation": 4007226333,
										"hovedtype": "REGISTER",
										"organisationsNavn": [
											{
												"navn": "Reelle ejere",
												"periode": {
													"gyldigFra": "1901-01-01",
													"gyldigTil": null
												},
												"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
											}
										],
										"attributter": [
											{
												"sekvensnr": 0,
												"type": "FUNKTION",
												"vaerditype": "string",
												"vaerdier": [
													{
														"vaerdi": "Reelle ejere",
														"periode": {
															"gyldigFra": "1901-01-01",
															"gyldigTil": null
														},
														"sidstOpdateret": "2017-11-06T13:51:18.000+01:00"
													}
												]
											}
										],
										"medlemsData": [
											{
												"attributter": [
													{
														"sekvensnr": 0,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som bestyrelsesmedlem",
																"periode": {
																	"gyldigFra": "2019-05-27",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													},
													{
														"sekvensnr": 1,
														"type": "BETYDELIG_INDFLYDELSE_VIA_ROLLE",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Er reel ejer som udpeget daglig ledelse",
																"periode": {
																	"gyldigFra": "2019-05-27",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													},
													{
														"sekvensnr": 0,
														"type": "FUNKTION",
														"vaerditype": "string",
														"vaerdier": [
															{
																"vaerdi": "Reel ejer",
																"periode": {
																	"gyldigFra": "2019-05-27",
																	"gyldigTil": null
																},
																"sidstOpdateret": "2019-05-27T15:08:31.000+02:00"
															}
														]
													}
												]
											}
										]
									}
								]
							}
						],
						"fusioner": [],
						"spaltninger": [],
						"virksomhedMetadata": {
							"nyesteNavn": {
								"navn": "F.L.Smidth fonden for diplomingeniørstuderende ved DTU",
								"periode": {
									"gyldigFra": "2017-11-06",
									"gyldigTil": null
								},
								"sidstOpdateret": "2017-11-09T15:06:12.000+01:00"
							},
							"nyesteBinavne": [],
							"nyesteVirksomhedsform": {
								"virksomhedsformkode": 90,
								"kortBeskrivelse": "FON",
								"langBeskrivelse": "Fonde og andre selvejende institutioner",
								"ansvarligDataleverandoer": "T&S",
								"periode": {
									"gyldigFra": "1901-01-01",
									"gyldigTil": null
								},
								"sidstOpdateret": "2013-11-22T21:57:52.000+01:00"
							},
							"nyesteBeliggenhedsadresse": {
								"landekode": "DK",
								"fritekst": null,
								"vejkode": 24,
								"kommune": {
									"kommuneKode": 173,
									"kommuneNavn": "LYNGBY-TAARBÆK",
									"periode": {
										"gyldigFra": "2007-01-01",
										"gyldigTil": null
									},
									"sidstOpdateret": "2006-11-13T00:00:00.000+01:00"
								},
								"husnummerFra": 101,
								"adresseId": "cb1667b2-0103-4696-82c3-11f4cd34ab3d",
								"sidstValideret": "2017-11-09T15:27:35.088+01:00",
								"husnummerTil": null,
								"bogstavFra": "A",
								"bogstavTil": null,
								"etage": null,
								"sidedoer": null,
								"conavn": "Danmarks Tekniske Universitet",
								"postboks": null,
								"vejnavn": "Anker Engelunds Vej",
								"bynavn": null,
								"postnummer": 2800,
								"postdistrikt": "Kgs. Lyngby",
								"periode": {
									"gyldigFra": "2017-11-06",
									"gyldigTil": null
								},
								"sidstOpdateret": "2017-11-09T15:06:12.000+01:00"
							},
							"nyesteHovedbranche": {
								"branchekode": "889910",
								"branchetekst": "Foreninger, legater og fonde med sygdomsbekæmpende, sociale og velgørende formål",
								"periode": {
									"gyldigFra": "2008-01-01",
									"gyldigTil": null
								},
								"sidstOpdateret": "2007-12-21T11:55:53.000+01:00"
							},
							"nyesteBibranche1": null,
							"nyesteBibranche2": null,
							"nyesteBibranche3": null,
							"nyesteStatus": null,
							"nyesteKontaktoplysninger": [],
							"antalPenheder": 1,
							"nyesteAarsbeskaeftigelse": null,
							"nyesteKvartalsbeskaeftigelse": null,
							"nyesteMaanedsbeskaeftigelse": null,
							"sammensatStatus": "Aktiv",
							"stiftelsesDato": "1901-01-01",
							"virkningsDato": "1901-01-01"
						},
						"samtId": 7,
						"fejlRegistreret": false,
						"dataAdgang": 0,
						"enhedsNummer": 4000824158,
						"enhedstype": "VIRKSOMHED",
						"sidstIndlaest": "2019-09-12T17:06:41.470+02:00",
						"sidstOpdateret": "2019-05-27T15:08:31.000+02:00",
						"fejlVedIndlaesning": false,
						"naermesteFremtidigeDato": null,
						"fejlBeskrivelse": null,
						"virkningsAktoer": "PO"
					}
				}
			}
		]
	}
}


const Pool = require('pg').Pool


/// CONSTANTS ///
const ROLE = 'FUNKTION';
const PERSON = 'PERSON';

/**
 * Checks if the given person is still an active member of the company (ex. not terminated)
 * 
 * @input person Defined as Vrvirksomhed -> deltagerRelation -> deltager in the company.
**/
const activeMember = (person) => {
	if (person.organisationer.length > 0 && person.organisationer[0].medlemsData.length > 0 && person.organisationer[0].medlemsData[0].attributter.length > 0) {
		var attributes = person.organisationer[0].medlemsData[0].attributter;
		for (var i = 0; i < attributes.length; i++) {
			if (attributes[i].type === ROLE && attributes[i].vaerdier.length > 0 && attributes[i].vaerdier[0].periode.gyldigTil != null && new Date(attributes[i].vaerdier[0].periode.gyldigTil) < new Date())
				return false;
		}
		return true;
	}
	return false;
}

/**
 * Parses a single company and people in that company into a format compatible with our database structure.
 * Notes:
 * - Added company name.
 * - Person name is full name, and not split into first_name, last_name.
 * 
 * @input entry Defined as 'Vrvirksomhed' in the CVR JSON data.
**/
const parse = (entry) => {
	var persons = [];
	
	for (var i = 0; i < entry.deltagerRelation.length; i++) {
		var person = deltagerRelation[i].deltager;
		if (person.enhedstype === PERSON && activeMember(person)) {
			persons.push({
				name: person.navne[0].navn,
				country_code: person.beliggenhedsadresse[0].landekode
			});
		}
	}
	
	return {
		persons: persons,
		company: {
			name: entry.virksomhedMetadata.nyesteNavn.navn,
			address: (nyesteBeliggenhedsadresse.postnummer + ' ' + nyesteBeliggenhedsadresse.postdistrikt + ' ' + nyesteBeliggenhedsadresse.vejnavn + ' ' + (nyesteBeliggenhedsadresse.husnummerFra || '') + (nyesteBeliggenhedsadresse.bogstavFra || '')).trim(),
			country_code: entry.virksomhedMetadata.nyesteBeliggenhedsadresse.landekode,
			vat: 'DK-' + entry.cvrNummer.toString().padStart(8, '0'),
			starting_date: entry.sidstOpdateret
		}
	}
}

/**
 * Parses all found companies and adds them to the PostgreSQL database.
 * Note: A bit unsure about this part - will need to discuss it Tuesday.
**/
async function parseAllAndSave (list) => {
	const pool = new Pool({
		user: 'username',
		host: 'localhost',
		database: 'regtic',
		password: 'password',
		port: 1150
	})
	
	for (var i = 0; i < list.hits.hits.length; i++) {
		var result = parse(list.hits.hits[i]._source.Vrvirksomhed)
		var company = result.company
		var result_company
		var result_person
		
		result_company = await pool.query(
			`INSERT INTO companies (address, vat, starting_date, country_code) VALUES ($1, $2, $3, $4) ON CONFLICT (vat) DO
			UPDATE SET address = $1, country_code = $4 RETURNING id`, [company.address, company.vat, company.starting_date, company.country_code])
		
		for (var j = 0; j < result.persons.length; j++) {
			var person = result.persons[j]
			result_person = await pool.query(`INSERT INTO persons (first_name, country_code) VALUES ($1, $2, $3) ON CONFLICT (first_name, country_code) DO NOTHING RETURNING id`, [person.name, person.country_code])
			await pool.query('INSERT INTO company_to_person (company, person) VALUES ($1, $2) ON CONFLICT (company, person) DO NOTHING', [result_company.rows[0].id, result_person.rows[0].id])
		}
	}
}

console.log(parse(entry.hits.hits[0]._source.Vrvirksomhed));